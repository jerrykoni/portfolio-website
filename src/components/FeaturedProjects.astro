---
import ProjectCard from './ProjectCard.astro'
import { Heading, Link } from 'accessible-astro-components'
import { Icon } from 'astro-icon/components'
import { getCollection } from 'astro:content'

// Import images directly for optimization
import projectImage1 from '@assets/images/projects/project-image-1.png'
import projectImage2 from '@assets/images/projects/project-image-2.png'
import projectImage3 from '@assets/images/projects/project-image-3.png'

/**
 * FeaturedProjects Component
 *
 * @description A component that displays featured projects from Astro Content Collections
 */
interface Props {
  /**
   * Additional classes to apply to the section
   */
  class?: string
  /**
   * The number of projects to display
   * @default 3
   */
  limit?: number
  /**
   * The title for the section
   * @default "Featured projects"
   */
  title?: string
}

const { class: className, limit = 3, title = 'Featured projects' } = Astro.props

// Get projects from content collection
const projects = await getCollection('projects')
const projectImages = [projectImage1, projectImage2, projectImage3]

// Limit projects and add featured images
const featuredProjects = projects.slice(0, limit).map((project, index) => ({
  ...project,
  featuredImage: projectImages[index % projectImages.length],
}))
---

<section id="mobile-projects" class:list={[className, 'py-12 md:py-16 bg-gray-50 dark:bg-gray-800 border-t border-b border-gray-200 dark:border-gray-700']}>  
  <div class="container">
    <Heading level="h2" class="mb-12 text-center md:text-left">{title}</Heading>
    <div class="grid grid-cols-1 gap-12 md:grid-cols-2 lg:grid-cols-3">
      {
        featuredProjects.map((project) => (
          <div class="transition-transform duration-300 motion-safe:hover:-translate-y-2 motion-safe:hover:shadow-2xl motion-safe:focus-within:-translate-y-2 motion-safe:focus-within:shadow-2xl rounded-2xl">
            <ProjectCard
              imageComponent={project.featuredImage}
              imageAlt={project.data.title}
              loading="eager"
              url={'/portfolio/' + project.id}
              headingLevel="h2"
              title={project.data.title}
              footer={'Author: ' + project.data.author}
            >
              {project.data.description}
            </ProjectCard>
          </div>
        ))
      }
    </div>
    <div class="mt-12">
      <Link href="/portfolio/" isButton animateOnHover animationType="nudge">
        View all projects
        <Icon aria-hidden="true" name="lucide:arrow-right" size="1.5rem" />
      </Link>
    </div>
  </div>
</section>
